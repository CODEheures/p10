{% extends "skeleton.html" %}
{% block activeDashboard %}
active
{% endblock %}
{% block body %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Dashboard</h1>
</div>

<div class="row">
  <div class="col">
    <h2>Echantillon d'images</h2>
  </div>
</div>
<div class="row row-cols-{{ indexes | length }}">
  {% for index in indexes %}
  <div class="col">
    <div class="d-flex flex-column">
      <a class="images-anchors" href="/sample_image?index={{ index }}" data-lightbox="photos">
      <img class="images w-100" src='/sample_image?index={{ index }}'/>
    </a>
    <p class="text-center">{{ index }}</p>
    </div>
  </div>
  {% endfor %}
</div>  

<div class="row mt-5">
  <div class="col">
    <div class="d-flex justify-content-center">
      <button disabled id="btnSamplesPrevious" class="btn btn-primary">Charger les {{ indexes | length}} prec√©dentes</button>
      <button id="btnSamplesNext" class="btn btn-primary ml-3">Charger les {{ indexes | length }} suivantes</button>
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <h2>Exploration dataset</h2>
  </div>
</div>
<form id="form-values-by-step">
  <div class="form-row">
    <div class="form-group form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="train-check-1">
      <label class="form-check-label" for="train-check-1">Train</label>
    </div>
    <div class="form-group form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="valid-check-1">
      <label class="form-check-label" for="valid-check-1">Valid</label>
    </div>
    <div class="form-group form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="test-check-1">
      <label class="form-check-label" for="test-check-1">Test</label>
    </div>
  </div>
  <button type="submit" class="btn btn-primary">Actualiser</button>
</form>
<div class="row">
  <div class="col">
    <img class="w-100" id="values-by-step" src=''/>
  </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
  // Images
  const manageImg = () => {
    const searchParam = new URLSearchParams()
    let indexes = []
    const anchors = Array.from(document.querySelectorAll('.images-anchors'))
    const images = Array.from(document.querySelectorAll('.images'))
    const count_indexes = images.length
    let start_image  = 0
    const btnSamplesPrevious = document.getElementById('btnSamplesPrevious')
    const btnSamplesNext = document.getElementById('btnSamplesNext')

    update = async () => {
      const searchParam = new URLSearchParams()
      searchParam.set('start_image', start_image.toString())
      const response = await fetch('/images-indexes?' + searchParam.toString())
      const result = await response.json()
      let counter = 0
      for (const index of result.indexes)
      {
        const url = "sample_image?index=" + index
        anchors[counter].href=url
        images[counter].src=url
        counter++
      }
      if (start_image === 0)
      {
        btnSamplesPrevious.setAttribute('disabled', '')
      } else {
        btnSamplesPrevious.removeAttribute('disabled')
      }
    }

    btnSamplesNext.onclick = () => {
      start_image += count_indexes
      update()
    }

    btnSamplesPrevious.onclick = () => {
      start_image -= count_indexes
      update()
    }
  }
  manageImg();
</script>
<script type="module">
  // Form graph values_by_step
  const manageValuesByStep = () => {
    const searchParam = new URLSearchParams(window.location.href.split('?')[1])
    const graph = document.getElementById('values-by-step')
    const form = document.getElementById('form-values-by-step')
    const trainCheckBox1 = document.getElementById('train-check-1')
    const validCheckBox1 = document.getElementById('valid-check-1')
    const testCheckBox1 = document.getElementById('test-check-1')
    const trainCheckBox1Checked = searchParam.has('train-check-1') ? searchParam.has('train-check-1')=='true' : true;
    const validCheckBox1Checked = searchParam.has('valid-check-1') ? searchParam.has('valid-check-1')=='true' : true;
    const testCheckBox1Checked = searchParam.has('test-check-1') ? searchParam.has('test-check-1')=='true' : true;

    trainCheckBox1.checked = trainCheckBox1Checked
    validCheckBox1.checked = validCheckBox1Checked
    testCheckBox1.checked = testCheckBox1Checked

    const update = () => {
      searchParam.set('train', trainCheckBox1.checked.toString())
      searchParam.set('valid', validCheckBox1.checked.toString())
      searchParam.set('test', testCheckBox1.checked.toString())
      searchParam.set('x', 'width')
      graph.src="/values-by-step?" + searchParam.toString()
    }

    form.onsubmit = (event) => {
      event.preventDefault();
      update()
    }

    update()
  }
  manageValuesByStep()

</script>
{% endblock %}
