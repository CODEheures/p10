{% extends "/skeleton.html" %}
{% block activePrediction %}
active
{% endblock %}
{% block body %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1>Prediction</h1>
</div>

<div class="row">
  <div class="col">
    <h2>Choisir une images</h2>
  </div>
</div>
{% with mode='predict' %}
  {% include('/common/sample_images.html') %}
{% endwith %}

<div class="row">
  <div class="col">
    <h2>Résultat de la prédiction</h2>
    <div id="loader" class="d-none align-items-center">
      <strong>Loading...</strong>
      <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div>
    </div>
    <img id="predict-image" class="w-100"/>
  </div>
</div>
{% endblock %}

{% block script %}
{% include('/common/sample_images_script.html') %}
<script type="text/javascript">
  // Images
  const manageImgClick = () => {
    const images = Array.from(document.querySelectorAll('.images'))
    const predictImg = document.getElementById('predict-image')
    const loader = document.getElementById('loader')
    for (const image of images)
    {
      image.onclick = async () => {
        predictImg.classList.add('d-none')
        loader.classList.remove('d-none')
        loader.classList.add('d-flex')
        const searchParam = new URLSearchParams(image.src.split('?')[1])
        const index = searchParam.get('index')
        predictImg.src = "predict_image?index=" + index
      }
    }

    predictImg.addEventListener("load", () => {
      predictImg.classList.remove('d-none')
      loader.classList.add('d-none')
      loader.classList.remove('d-flex')
    })
  }
  manageImgClick();
</script>
{% endblock %}